@if (loading) {
  <mat-progress-bar color="accent" mode="indeterminate">
  </mat-progress-bar>
}

@if (error) {
  <div>
    <app-error-message [error]="error"></app-error-message>
  </div>
}

@if (!error) {
  <div>
    @if (filterTemplate) {
      <div class="container filter">
        <ng-container *ngTemplateOutlet="filterTemplate"></ng-container>
        <div class="filterButtons">
          <button mat-icon-button (click)="setFilter()">
            <mat-icon>search</mat-icon>
          </button>
          <button mat-icon-button (click)="clearFilter()">
            <mat-icon>clear</mat-icon>
          </button>
        </div>
      </div>
    }
    @if (entities && entities.length > 0) {
      <div class="container search-results">
        <mat-paginator
          [length]="total"
          [pageSize]="limit"
          [pageSizeOptions]="[5, 10, 25, 100]"
          [pageIndex]="n"
          (page)="setCurrentPage($event)"
          [showFirstLastButtons]="true"
          [disabled]="loading"
          aria-label="Select page"
          >
        </mat-paginator>
        <div class="area">
          <!-- custom list -->
          @if (resultItemTemplate) {
            <div>
              @if (!table) {
                <div>
                  @for (a of entities; track a) {
                    <div>
                      <ng-container
                        *ngTemplateOutlet="resultItemTemplate; context: { a }"
                      ></ng-container>
                    </div>
                  }
                </div>
              }
              @if (table) {
                <div>
                  <ng-container
                    *ngTemplateOutlet="resultItemTemplate; context: { entities }"
                  ></ng-container>
                </div>
              }
            </div>
          }
          <!-- fallback to simple list -->
          @if (!resultItemTemplate) {
            <div>
              @for (a of entities; track a) {
                <div>
                  <app-entity-element [entity]="a"></app-entity-element>
                </div>
              }
            </div>
          }
          <!-- loading veil -->
          @if (loading) {
            <div class="processing-indicator">
              <div><mat-spinner diameter="33"></mat-spinner></div>
              <div class="pt-5 text-black text-center">
                {{ statusDescription$ | async }} ...
              </div>
            </div>
          }
        </div>
        <mat-paginator
          [length]="total"
          [pageSize]="limit"
          [pageSizeOptions]="[5, 10, 25, 100]"
          [pageIndex]="n"
          (page)="setCurrentPage($event)"
          [showFirstLastButtons]="true"
          [disabled]="loading"
          aria-label="Select page"
          >
        </mat-paginator>
      </div>
    }
  </div>
}
